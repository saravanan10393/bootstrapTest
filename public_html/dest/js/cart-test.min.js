/*! cart-test 2016-03-23 */
var cartApp=angular.module("cartApp",["ui.bootstrap","ui.router"]);cartApp.constant("Constants",{ELIGIBLE_FOR_FREE_SHIPPING:50,SHIPPING_CHARGE:50,DISCOUNT_PRIZE:7,COUPEN_CODE:"JF10",ERROR:{INVALID_COUPEN_CODE:"Invalid Promo-Code!."}}),cartApp.controller("cartController",["cartService","Constants","$uibModal","$scope",function(a,b,c,d){var e=this;e.wishList=[],e.error={},a.getCartDetails().then(function(a){console.log("fetched data ",a.data),e.orderDetails=a.data.productsInCart,e.calculateOrderTotal(e.orderDetails)},function(a){console.log("fetched error ",a)}),e.calculateOrderTotal=function(a){a=a||e.orderDetails,0!=a.length&&(e.orderCashDetails={currency:"$",subTotal:0,discountPrize:0,shippingPrize:0,estimatedTotal:0},e.orderCashDetails.currency=a[0].c_currency,a.forEach(function(a){a.totalPrize=a.p_price*a.p_quantity,e.orderCashDetails.subTotal+=a.totalPrize}),e.orderCashDetails.shippingPrize=Number(e.orderCashDetails.subTotal)>=b.ELIGIBLE_FOR_FREE_SHIPPING?0:b.SHIPPING_CHARGE,f())};var f=function(){e.orderCashDetails.estimatedTotal=e.orderCashDetails.subTotal+e.orderCashDetails.shippingPrize-e.orderCashDetails.discountPrize};e.applyCoupenCode=function(a){a==b.COUPEN_CODE?(e.orderCashDetails.discountPrize=b.DISCOUNT_PRIZE,f()):e.error.invalidCoupenCode=b.ERROR.INVALID_COUPEN_CODE},e.openEditModal=function(a){d.chosenItem=a,d.modalInstance=c.open({templateUrl:"modal/itemDetail.html",controller:"cartItemEditCtrl",scope:d}),d.modalInstance.result.then(function(a){angular.extend(_.findWhere(e.orderDetails,{p_id:a.p_id}),a),e.calculateOrderTotal()},function(){console.error("Modal dismissed at: ")})},e.removeItemFromCart=function(a){var b=_.findIndex(e.orderDetails,{p_id:a});e.orderDetails.splice(b,1),e.calculateOrderTotal()},e.saveForLater=function(a){e.wishList.push(angular.copy(a))}}]),cartApp.controller("cartItemEditCtrl",["$scope",function(a){console.log("modal scope ",a.chosenItem),a.selectedItem=angular.copy(a.chosenItem),a.qty=Array.apply(null,Array(20)).map(function(){return Math.random()}),a.getSelectedColor=function(b){return console.log("method is calling ",b),b.hexcode==a.selectedItem.p_selected_color.hexcode?"active":void 0},a.updateItem=function(){a.modalInstance.close(a.selectedItem)},a.cancel=function(){a.modalInstance.dismiss("dismise")}}]),angular.module("cartApp").factory("cartService",["$http",function(a){var b={};return b.getCartDetails=function(){return a.get("./asserts/json/cart.json")},b}]);